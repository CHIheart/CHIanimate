define("index",[],function(e,n,t){});seajs.use("index");define("toplinks",[],function(e,n,t){var a=$(".TOPLINKS").on("mouseenter",".USERMENU",function(e){$(this).addClass("on").find("dd ul").slideDown()}).on("mouseleave",".USERMENU",function(e){$(this).find("dd ul").slideUp(function(){$(".USERMENU").removeClass("on")})});angular.module("TOPLINKS",[]).controller("CtrlTopLinks",["$scope","$timeout",function(e,n){function t(){angular.element(".LOGIN").scope().open()}e.login=function(){if(!$(".LOGIN").length)$.ajax({url:"/ajax/loadPlugin.php",type:"POST",dataType:"html",data:{plugin:"login"}}).success(function(e){$("body").append(e);t()});else t()};e.logout=function(){n(function(){e.online=false;n(l,100)},100)}}]);angular.bootstrap(a,["TOPLINKS"]);function l(){a.children().css({visibility:"visible"})}l();return});seajs.use("toplinks");define("topcart",[],function(e,n,t){var a,l;angular.module("TOPCART",[]).controller("Ctrl_TOPCART",["$scope","$timeout","$http",function(e,n,t){e.carts=[];var i=e.carts;e.allNums=$('span[ng-bind="allNums"]').text()*1;e.allPrice=0;function s(){e.allNums=e.allPrice=0;for(var n=0;n<i.length;n++){e.allNums+=i[n].num;i[n].pro.price<0||isNaN(e.allPrice)?e.allPrice="待客服报价":e.allPrice+=i[n].pro.price*i[n].num}!isNaN(e.allPrice)&&(e.allPrice+="元");!i.length&&(d.show(),r.add(c).hide())}var o,u=false,c=$(".TOPCARTLOAD"),r=$(".TOPCARTINFO"),d=$(".TOPCARTNONE");e.update=function(){if(!u){u=true;r.hide();c.stop(true,true).slideDown();o=n(function(){u=false},3e3);t.get("/ajax/header/topcarts").success(function(n){if(n.result){i=e.carts=n.carts;a();s()}else{}})}else a();function a(){c.hide();i.length?(d.hide(),r.stop(true,true).delay(100).slideDown()):(r.hide(),d.show())}};e.close=function(){c.add(r).add(d).stop().slideUp()};$(".TOPCARTINFO").on("click","i.lcz-times",function(n){n.preventDefault();var t=this,o=function(){var e=angular.element(".WINLIT").scope();a=e.confirm;l=e.alert},u=function(){a("删除货物","真的要删除这条购物信息吗？","question",function(){var n=$(t).closest("li"),o=n.data("cart-id"),u=n.data("cart-parent-id"),c=[],r;for(var d=i.length-1;d>=0;d--){r=i[d];(r.id==o||r.parent==o)&&(i.splice(d,1),c.push(r.id))}s();e.$apply();$.ajax({url:"/ajax/header/cart_delete",type:"POST",dataType:"json",data:{ids:c}}).success(function(e){if(e.result){a.close()}else{l("删除失败",e.message,"frown")}});n=r=c=null})};!$(".WINLIT").length?$.ajax({url:"/ajax/loadPlugin.php",type:"POST",dataType:"html",data:{plugin:"winlit"}}).success(function(e){$("body").append(e);o();u()}):(!l&&o(),u());e.close()})}]);angular.bootstrap($(".TOPCART"),["TOPCART"])});seajs.use("topcart");