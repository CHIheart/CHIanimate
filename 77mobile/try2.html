<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!--[if lt IE 9]>
<script>
document.write("<span>请不要使用低端浏览器查看，可以使用IE9+，火狐，谷歌，Opera，Safari或任何国产Webkit内核的浏览器。</span>")
document.execCommand("stop");
</script>
<![endif]-->
<meta content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>无标题文档</title>
<link rel="stylesheet" type="text/css" href="../font-awesome-4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="less/try.css">
<link rel="stylesheet" type="text/css" href="less/colorpicker.css">
<link rel="stylesheet" type="text/css" href="less/iconpicker.css">
<link rel="stylesheet" type="text/css" href="less/datepicker.css">
</head>

<body>
<header>
	<a><i class="fa fa-list"></i>菜单</a>
    <h1>这个就是本页的大标题啦！！！</h1>
    <a><i class="fa fa-cogs"></i>操作</a>
</header>
<div class="CHIheaderBG"></div>

<aside id="LeftMenu"><div>
	<h2>后台功能导航<q class="fa fa-times-circle"></q></h2>
    <ul class="CHImenus">
        <li><a href="http://www.baidu.com"><i class="fa fa-cogs"></i>百度</a></li>
        <li><a href="http://www.qq.com"><i class="fa fa-cogs"></i>QQ</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
        <li><a href="#"><i class="fa fa-cogs"></i>系统设置</a></li>
    </ul>
</div></aside>
<aside id="RightMenu"><div>
	<h2>操作行为<q class="fa fa-times-circle"></q></h2>
    <dl class="CHIfuns">
    	<dt>批量选择</dt>
        <dd>
            <a href="#" class="select-all"><i class="fa fa-cogs"></i>全选</a>
            <a href="#" class="select-reverse"><i class="fa fa-cogs"></i>全反选</a>
            <a href="#" class="select-none"><i class="fa fa-cogs"></i>全不选</a>
        </dd>
    </dl>
    <dl class="CHIfuns">
    	<dt>批量操作</dt>
        <dd>
            <a href="#"><i class="fa fa-cogs"></i>删除</a>
            <a href="#"><i class="fa fa-cogs"></i>移动</a>
            <a href="#"><i class="fa fa-cogs"></i>显示</a>
        </dd>
    </dl>
    <dl class="CHIfuns">
    	<dt>其它动作</dt>
        <dd>
            <a href="#"><i class="fa fa-cogs"></i>隐藏页眉</a>
            <a href="#"><i class="fa fa-cogs"></i>切换语种</a>
            <a href="#"><i class="fa fa-cogs"></i>退出</a>
        </dd>
    </dl>
</div></aside>

<ul class="CHIinfors">
	<li>
    	<div class="topic">
        	<input type="checkbox" name="ids[]" value="1" id="ids1"><label for="ids1" class="fa"></label>
            <h3>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</h3>
            <a href="#" class="fa fa-chevron-right"></a>
        </div>
        <div class="content">
        	<div class="album"><table><tr>
            	<td><a href="#"><img data-src="http://f.hiphotos.baidu.com/image/pic/item/3c6d55fbb2fb43162040a87c23a4462309f7d35d.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://b.hiphotos.baidu.com/image/h%3D360/sign=b4f5d16b1338534393cf8127a312b01f/e1fe9925bc315c60b57749e88eb1cb13485477d2.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://h.hiphotos.baidu.com/image/h%3D360/sign=1d85cada2d738bd4db21b437918b876c/f7246b600c3387442cc99a7b520fd9f9d72aa0ad.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://h.hiphotos.baidu.com/image/h%3D360/sign=0d0d0035708da977512f802d8050f872/91529822720e0cf390578dfd0946f21fbe09aa10.jpg" data-url=""></a></td>
            </tr></table></div>
            <div class="summary">
            	<p>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</p>
            	<p>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</p>
            </div>
            <ul class="tools">
            	<li><i class="fa fa-cog"></i></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            </ul>
        </div>
    </li>
	<li>
    	<div class="topic">
        	<input type="checkbox" name="ids[]" value="2" id="ids2"><label for="ids2" class="fa"></label>
            <h3>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</h3>
            <a href="#" class="fa fa-chevron-right"></a>
        </div>
        <div class="content">
        	<div class="album"><table><tr>
            	<td><a href="#"><img data-src="http://h.hiphotos.baidu.com/image/h%3D360/sign=887bec218982b90122adc535438ca97e/4e4a20a4462309f7d7d56a14710e0cf3d7cad67a.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://g.hiphotos.baidu.com/image/h%3D360/sign=ac93a13e6863f624035d3f05b745eb32/203fb80e7bec54e7685d3019ba389b504fc26a07.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://d.hiphotos.baidu.com/image/h%3D360/sign=ec0d989f8126cffc762ab9b489014a7d/b3fb43166d224f4a7bec9d150af790529822d1bb.jpg" data-url=""></a></td>
            	<td><a href="#"><img data-src="http://e.hiphotos.baidu.com/image/h%3D360/sign=74e16574f8f2b211fb2e8348fa816511/bd315c6034a85edfe968fd244a540923dc5475d4.jpg" data-url=""></a></td>
            </tr></table></div>
            <div class="summary">
            	<h4>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</h4>
            	<p>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</p>
            	<p>这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！这是一条信息的名称，很长很长，过长的部分就用省略号了吧！</p>
            </div>
            <ul class="tools">
            	<li><i class="fa fa-cog"></i></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            	<li><a href="#"><i class="fa fa-trash"></i>删除</a></li>
            </ul>
        </div>
    </li>
</ul>
<div class="CHIform"><ul>
	<li><var>短文本框</var><dfn><input type="text" class="CHItext short"><span class="CHItip ok">成功信息ok</span></dfn></li>
    <li><var>中文本框</var><dfn><input type="text" class="CHItext middle"></dfn></li>
    <li><var>长文本框</var><dfn class="font0"><input type="text" class="CHItext long"></dfn></li>
    <li><var>小文本域</var><dfn><textarea class="CHItextarea small"></textarea></dfn></li>
    <li><var>大文本域</var><dfn class="font0"><textarea class="CHItextarea large"></textarea></dfn></li>
    <li><var>单选按钮</var><dfn>
    	<input class="CHIradio" type="radio" name="radios" id="radio1"><label for="radio1">第一选项第一选项第一选项第一选项第一选项第一选项第一选项</label>
    	<input class="CHIradio" type="radio" name="radios" id="radio2"><label for="radio2">第二选项第二选项第二选项第二选项第二选项第二选项</label>
    	<input class="CHIradio" type="radio" name="radios" id="radio3"><label for="radio3">第三选项第三选项第三选项第三选项第三选项第三选项第三选项第三选项</label>
    </dfn></li>
    <li><var>复选框</var><dfn class="boxes"><!--这个类只不过让界面看起来好看一些-->
    	<input class="CHIcheckbox" type="checkbox" name="boxes[]" id="box1"><label for="box1">第一选项第一选项第一选项第一选项第一选项第一选项第一选项</label>
    	<input class="CHIcheckbox" type="checkbox" name="boxes[]" id="box2"><label for="box2">第二选项第二选项第二选项第二选项第二选项第二选项</label>
    	<input class="CHIcheckbox" type="checkbox" name="boxes[]" id="box3"><label for="box3">第三选项第三选项第三选项第三选项第三选项第三选项第三选项第三选项</label>
    </dfn></li>
    <li><var>两项开关</var><dfn>
    	<input class="CHIswitch magnifyPlus" type="radio" name="magnify" id="magnifyPlus" checked><label for="magnifyMinus">放大</label>
    	<input class="CHIswitch magnifyMinus" type="radio" name="magnify" id="magnifyMinus"><label for="magnifyPlus">缩小</label>
    	<input class="CHIswitch playPlay" type="radio" name="play" id="playPlay" checked><label for="playPause">播放</label>
    	<input class="CHIswitch playPause" type="radio" name="play" id="playPause"><label for="playPlay">暂停</label>
    	<input class="CHIswitch eyeShow" type="radio" name="eye" id="eyeShow" checked><label for="eyeHide">显示</label>
    	<input class="CHIswitch eyeHide" type="radio" name="eye" id="eyeHide"><label for="eyeShow">隐藏</label>
    	<input class="CHIswitch folderOpen" type="radio" name="folder" id="folderOpen" checked><label for="folderClose">打开</label>
    	<input class="CHIswitch folderClose" type="radio" name="folder" id="folderClose"><label for="folderOpen">关闭</label>
    	<input class="CHIswitch favorYes" type="radio" name="favor" id="favorYes" checked><label for="favorNo">加入收藏</label>
    	<input class="CHIswitch favorNo" type="radio" name="favor" id="favorNo"><label for="favorYes">解除收藏</label>
    	<input class="CHIswitch bookmarkYes" type="radio" name="bookmark" id="bookmarkYes" checked><label for="bookmarkNo">加入书签</label>
    	<input class="CHIswitch bookmarkNo" type="radio" name="bookmark" id="bookmarkNo"><label for="bookmarkYes">解除书签</label>
    	<input class="CHIswitch lockYes" type="radio" name="lock" id="lockYes" checked><label for="lockNo">加锁</label>
    	<input class="CHIswitch lockNo" type="radio" name="lock" id="lockNo"><label for="lockYes">解锁</label>
    	<input class="CHIswitch male" type="radio" name="sex" id="male" checked><label for="female">男</label>
    	<input class="CHIswitch female" type="radio" name="sex" id="female"><label for="male">女</label>
    	<input class="CHIswitch man" type="radio" name="sex2" id="man" checked><label for="woman">男</label>
    	<input class="CHIswitch woman" type="radio" name="sex2" id="woman"><label for="man">女</label>
    	<input class="CHIswitch alarmYes" type="radio" name="alarm" id="alarmYes" checked><label for="alarmNo">提醒</label>
    	<input class="CHIswitch alarmNo" type="radio" name="alarm" id="alarmNo"><label for="alarmYes">取消</label>
    	<input class="CHIswitch bellYes" type="radio" name="bell" id="bellYes" checked><label for="bellNo">提醒</label>
    	<input class="CHIswitch bellNo" type="radio" name="bell" id="bellNo"><label for="bellYes">取消</label>
    	<input class="CHIswitch switchOn" type="radio" name="switch" id="switchOn" checked><label for="switchOff">打开</label>
    	<input class="CHIswitch switchOff" type="radio" name="switch" id="switchOff"><label for="switchOn">关闭</label>
    </dfn></li>
    <li><var>三项开关</var><dfn>
    	<input class="CHIswitch volumnOff" type="radio" name="volumn" id="volumnOff" checked><label for="volumnLow">静音</label>
    	<input class="CHIswitch volumnLow" type="radio" name="volumn" id="volumnLow"><label for="volumnHigh">低音</label>
    	<input class="CHIswitch volumnHigh" type="radio" name="volumn" id="volumnHigh"><label for="volumnOff">高音</label>
    	<input class="CHIswitch starEmpty" type="radio" name="star" id="starEmpty" checked><label for="starHalf">空星</label>
    	<input class="CHIswitch starHalf" type="radio" name="star" id="starHalf"><label for="starFull">半星</label>
    	<input class="CHIswitch starFull" type="radio" name="star" id="starFull"><label for="starEmpty">满星</label>
    </dfn></li>
    <li><var>四项开关</var><dfn>
    	<input class="CHIswitch alignLeft" type="radio" name="align" id="alignLeft" checked><label for="alignCenter">左对齐</label>
    	<input class="CHIswitch alignCenter" type="radio" name="align" id="alignCenter"><label for="alignRight">居中对齐</label>
    	<input class="CHIswitch alignRight" type="radio" name="align" id="alignRight"><label for="alignJustify">右对齐</label>
    	<input class="CHIswitch alignJustify" type="radio" name="align" id="alignJustify"><label for="alignLeft">分散对齐</label>
    </dfn></li>
    <li><var>颜色选择器</var><dfn>
    	<label class="CHIcolors" data-value=""></label>
    </dfn></li>
    <li><var>颜色选择器</var><dfn>
    	<label class="CHIcolors" data-value="#ff2e12"></label>
    </dfn></li>
    <li><var>图标选择器</var><dfn>
    	<label class="CHIicons" data-value="fa-yen fa-flip-vertical"></label>
    </dfn></li>
    <li><var>图标选择器</var><dfn>
    	<label class="CHIicons"></label>
    </dfn></li>
    <li><var>日期选择器</var><dfn>
    	<label class="CHIdates" data-value="2008-05-30"></label>
    </dfn></li>
    <li><var>日期选择器</var><dfn>
    	<label class="CHIdates"></label>
    </dfn></li>
    <li><var>文件上传</var><dfn><!--数量上限，保存于版块设置中，每次写出时按实际剩余量填写-->
    	<input type="file" class="CHIfile" name="uploads[]" id="upload" data-count="5" data-types="image" data-size="0">
        <label for="upload" class="CHIbutton"><i class="fa fa-upload"></i>点击上传图片</label>
        <span class="CHItip tip">只可以上传image大类的附件，还可以上传5个，大小不限制</span>
        <span class="CHItip tip">需要一个id，此id不仅是label的for，还是图片集的data-listen</span>
    </dfn></li>
    <li><var>图片集</var><dfn>
    	<div class="CHIalbum" data-listen="upload"><table><tr>
        	<td title="原有的图，点击放大"><a href="images/bg.jpg" target="_blank"><img src="images/bg.jpg"></a></td>
        	<td title="原有的图2，点击放大"><a href="images/bg2.jpg" target="_blank"><img src="images/bg2.jpg"></a></td>
        	<td title="一个视频"><a href="#someurl" target="_blank"><i class="fa fa-film"></i></a></td>
        	<td title="一个音频"><a href="#someurl" target="_blank"><i class="fa fa-music"></i></a></td>
        </tr></table></div>
        <a class="CHIbutton"><i class="fa fa-edit"></i>编辑图片集</a>
        <div class="CHIbuttons CHIbtns3">
        	<input type="button" class="CHIbutton CHIalbum-all" value="全选">
        	<input type="button" class="CHIbutton CHIalbum-reverse" value="反选">
        	<input type="button" class="CHIbutton CHIalbum-confirm" value="确定">
        </div>
    </dfn></li>
    <li><var>文件上传2</var><dfn>
    	<input type="file" class="CHIfile" name="uploads2[]" id="upload2">
        <label for="upload2" class="CHIbutton"><i class="fa fa-upload"></i>点击上传图片</label>
        <span class="CHItip tip">同一上上传域不可重复选择同一文件，但不同的上传域可以</span>
    </dfn></li>
    <li><var>图片集2</var><dfn>
    	<div class="CHIalbum" data-listen="upload2"><table><tr>
        	<td title="原有的图，点击放大"><a href="images/bg.jpg" target="_blank"><img src="images/bg.jpg"></a></td>
        	<td title="原有的图2，点击放大"><a href="images/bg2.jpg" target="_blank"><img src="images/bg2.jpg"></a></td>
        	<td title="一个视频"><a href="#someurl" target="_blank"><i class="fa fa-film"></i></a></td>
        	<td title="一个音频"><a href="#someurl" target="_blank"><i class="fa fa-music"></i></a></td>
        </tr></table></div>
        <a class="CHIbutton"><i class="fa fa-edit"></i>编辑图片集</a>
        <div class="CHIbuttons CHIbtns3">
        	<input type="button" class="CHIbutton CHIalbum-all" value="全选">
        	<input type="button" class="CHIbutton CHIalbum-reverse" value="反选">
        	<input type="button" class="CHIbutton CHIalbum-confirm" value="确定">
        </div>
    </dfn></li>
    <li><var>提示信息</var><dfn>
        <span class="CHItip warn">警告信息warn警告信息warn警告信息warn警告信息warn警告信息warn警告信息warn警告信息warn</span>
        <span class="CHItip tip">提示信息tip</span>
        <span class="CHItip ok">成功信息ok</span>
        <span class="CHItip error">错误信息error</span>
        <span class="CHItip fail">失败信息fail</span>
    </dfn></li>
    <li><var></var><dfn class="CHIbuttons CHIbtns3">
    	<input type="button" class="CHIbutton submit" value="提交（按钮）">
    	<input type="button" class="CHIbutton cancel" value="取消（按钮）">
    	<input type="button" class="CHIbutton reset" value="重置（按钮）">
    </dfn></li>
    <li><var></var><dfn class="CHIbuttons CHIbtns3">
    	<a href="#" class="CHIbutton submit"><i class="fa fa-check"></i>提交（链接）</a>
    	<a href="#" class="CHIbutton cancel"><i class="fa fa-times"></i>取消（链接）</a>
    	<a href="#" class="CHIbutton reset"><i class="fa fa-eraser"></i>重置（链接）</a>
    </dfn></li>
</ul></div>
<div class="CHIbuttons CHIbtns3">
    <input type="button" class="CHIbutton submit" value="提交（按钮）">
    <input type="button" class="CHIbutton cancel" value="取消（按钮）">
    <input type="button" class="CHIbutton reset" value="重置（按钮）">
</div>
<div class="CHIbuttons CHIbtns4">
	<input type="button" class="CHIbutton" value="按钮1">
	<input type="button" class="CHIbutton" value="按钮2">
	<input type="button" class="CHIbutton" value="按钮3">
	<input type="button" class="CHIbutton" value="按钮4">
</div>
<div class="CHIbuttons CHIbtns5">
	<input type="button" class="CHIbutton" value="按钮1">
	<input type="button" class="CHIbutton" value="按钮2">
	<input type="button" class="CHIbutton" value="按钮3">
	<input type="button" class="CHIbutton" value="按钮4">
	<input type="button" class="CHIbutton" value="按钮5">
</div>
<div class="CHIbuttons CHIbtns3">
    <a href="#" class="CHIbutton submit"><i class="fa fa-check"></i>提交（链接）</a>
    <a href="#" class="CHIbutton cancel"><i class="fa fa-times"></i>取消（链接）</a>
    <a href="#" class="CHIbutton reset"><i class="fa fa-eraser"></i>重置（链接）</a>
</div>
<div class="CHIbuttons CHIbtns4">
	<a href="#" class="CHIbutton"><i class="fa fa-align-center"></i>居中</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-left"></i>左对齐</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-right"></i>右对齐</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-justify"></i>分散</a>
</div>
<div class="CHIbuttons CHIbtns5">
	<a href="#" class="CHIbutton"><i class="fa fa-align-center"></i>居中</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-left"></i>左对齐</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-right"></i>右对齐</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-justify"></i>分散</a>
	<a href="#" class="CHIbutton"><i class="fa fa-align-center"></i>居中</a>
</div>

</body>
</html>
<script src="js/jq/jquery-2.1.3.min.js"></script>
<script src="js/plugin/bg.js"></script>
<script>
function isLowMobile(){
	return navigator.userAgent.indexOf('Android 4.0')>0;
}
var globalMomentum=!isLowMobile();
</script>
<script src="js/frame/iscroll.js"></script>
<script src="js/plugin/colorpicker.js"></script>
<script src="js/plugin/iconpicker.js"></script>
<script src="js/extend/date.js"></script>
<script src="js/plugin/datepicker.js"></script>
<script>
function IsPC() {
    var userAgentInfo = navigator.userAgent;
    var Agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
    var flag = true;
    for (var v = 0; v < Agents.length; v++) {
        if (userAgentInfo.indexOf(Agents[v]) > 0) {
            flag = false;
            break;
        }
    }
    return flag;
}

var counter=1,isMobile=!IsPC(),GlobalLock=false;
var GlobalAblumScrollOptions={scrollX:true,scrollY:false,momentum:globalMomentum,eventPassthrough:isMobile};
var GlobalAsideScrollOptions={tap:'click',momentum:globalMomentum};
$(function(){
	/*
	点击信息列表的标题栏的标题，展开内容栏
	如果有图片列表的话，且图片列表“未被初始化”则
	1.将图片列表的所有图片路径转换出来，图片使用data-src缩略图，链接使用data-url完整图
	2.待所有的图片调用完成之后，生成图片列表的拉动效果
	3.将图片列表标识为“已经初始化”
	*/
	$(".CHIinfors .topic h3").click(function(){
		var ALBUM=
		$(this).parent().next(".content").slideToggle(function(){
			if(ALBUM.size() && !ALBUM.data('inited'))
			{
				var imgs=ALBUM.find("img").data('ALBUM',ALBUM),
					id='Album'+ $(this).closest("li").index();
				ALBUM.data('counter',imgs.length).attr('id',id);
				imgs.each(function(){
					this.src=$(this).data("src");
					$(this).closest("a").attr({'href':$(this).data('url'),'target':'_blank'});
					$(this).removeData("src url")
					var album=$(this).data('ALBUM'),
						counter=album.data('counter');
					album.data('counter',counter-1);
					if(!album.data('counter'))
					{
						new IScroll('#'+album.attr('id'),GlobalAlbumScrollOptions);
						album.data('inited',true).removeData('counter');
						imgs=album=null;
					}
				});
			}
		}).find(".album");
	});
	//左右菜单
	$("#LeftMenu a").click(function(){
		location.href=$(this).attr("href");
	});
	var LeftMenu,RightMenu,
		LeftScroll=new IScroll("#LeftMenu",GlobalAsideScrollOptions),
		RightScroll=new IScroll("#RightMenu",GlobalAsideScrollOptions);
	function lockOn(){GlobalLock=true;}
	function lockOff(){setTimeout(function(){GlobalLock=false;},100);}
	$(".CHIfuns dt").click(function(){
		if(GlobalLock)return;
		lockOn();
		$(this).next("dd").slideToggle(function(){
			RightScroll.refresh();
			lockOff();
		});
	});
	LeftMenu=$("#LeftMenu").eq(0);
	LeftMenu.open=function(cbfun){
		if(!$.isFunction(cbfun))cbfun=$.noop;
		LeftMenu.animate({left:0},cbfun);
	}
	LeftMenu.close=function(cbfun){
		if(!$.isFunction(cbfun))cbfun=$.noop;
		LeftMenu.animate({left:'-100%'},cbfun);
	}
	RightMenu=$("#RightMenu").eq(0);
	RightMenu.open=function(cbfun){
		if(!$.isFunction(cbfun))cbfun=$.noop;
		RightMenu.animate({right:0},cbfun);
	}
	RightMenu.close=function(cbfun){
		if(!$.isFunction(cbfun))cbfun=$.noop;
		RightMenu.animate({right:'-100%'},cbfun);
	}
	$("header a:first-child").click(function(){
		LeftMenu.open();
	});
	$("header a:last-child").click(function(){
		RightMenu.open();
	});
	$("#LeftMenu h2 q").click(function(){
		LeftMenu.close();
	});
	$("#RightMenu h2 q").click(function(){
		RightMenu.close();
	});
	//批量选择的行为
	$(".select-all").attr("href","javascript:void(0)").click(function(){
		if(GlobalLock)return;
		lockOn();
		$(".CHIinfors :checkbox").prop("checked",true);
		RightMenu.close(lockOff);
	});
	//批量反选行为
	$(".select-reverse").attr("href","javascript:void(0)").click(function(){
		if(GlobalLock)return;
		lockOn();
		$(".CHIinfors :checkbox").each(function(){
			this.checked=!this.checked;
		});
		RightMenu.close(lockOff);
	});
	//文件域，一个文件域对应一个图片集，文件域的id，是图片集的data-listen
	$(".CHIform").on('change',':file',function(event){
		var id=this.id,
			file=this.files[0],
			name=file.name,
			type=file.type,
			size=file.size,
			date=file.lastModifiedDate.format(),
			album=$(".CHIalbum[data-listen='"+ id +"']")
		;
		/*data设置三种限制，数量count（0为不限制），类型types（IE9不支持input的accept属性），大小size（0为不限制）*/
		var SIZE=$(this).data("size"),reg_size=/^(\d+)(b|k|m)$/i,//合法的size是数字加单位B/K/M
			TYPES=$(this).data("types"),
			COUNT=$(this).data("count")+'',reg_count=/^\d+$/;//附件数量只使用正整数
		
		$(this).after(this.outerHTML);
		$(this).removeAttr('id');
		
		var result=reg_size.exec(SIZE);
		if(result!==null)
		{
			var bit=result[1],unit=result[2];
			if(bit)
			{
				switch(unit)
				{
					case 'm':
					case 'M':
						bit*=1024*1024;
						break;
					case 'k':
					case 'K':
						bit*=1024;
					default:;//b为单位
				}
				if(size>bit)
				{
					alert('文件超过大小限制：'+ SIZE +'！');
					$(this).remove();
					return false;
				}
			}
		}
		
		if(album.find('[title="'+ name +'"][data-size="'+ size +'"][data-date="'+ date +'"]').length)
		{//如果已经存在的就从DOM中删除
			alert("文件已经存在！");
			$(this).remove();
			return false;
		}
		/*
		类型判断，data-types可以使用以下格式
		1.大类型名，image|audio|video|text|script|office|package|font
		2.小类型名列表，例如pdf|txt|html|swf等
		*/
		var typeError=true,
			icon='',
			isImage=true,
			reg,
			beginning='(?:[a-z0-9]+\\|)*(',
			ending=')(?:\\|[a-z0-9]+)*';
		if(type.indexOf('image')>=0 && (result=/(gif|png|jpg|jpeg|ico|bmp)$/i.exec(type)))
		{
			reg=new RegExp(beginning + 'image|' + result[1] + ending,'i');
			if(!TYPES) typeError=false;
			else if(TYPES.match(reg)){ isImage=true; typeError=false;}
			else typeError=true;
		}
		else
		{
			isImage=false;
			var mainType='';

			//浏览器不支持的图像文件
			if(type.match(/^image/))
			{
				result=/\.(\w+?)$/i.exec(name);
				mainType='image|';
				icon='fa-image';
			}
			//浏览器不支持的图像文件
			else if((result=name.match(/\.(psd|ai|eps|tif|cdr)$/)))
			{
				mainType='image|';
				icon='fa-file-image-o';
			}
			//电子书
			else if((result=type.match(/\.pdf$/)))
			{
				icon='fa-file-pdf-o';
			}
			//音频
			else if(type.match(/^audio/))
			{
				mainType='audio|';
				result=/\.(\w+?)$/i.exec(name);
				icon='fa-music';
			}
			//视频
			else if(type.match(/^video/))
			{
				mainType='video|';
				result=/\.(\w+?)$/i.exec(name);
				icon='fa-film';
			}
			//swf文件
			else if(type.match(/flash$/))
			{
				mainType='flash|';
				icon='fa-video-camera';
			}
			//fla文件
			else if((result=name.match(/\.(fla)$/i)))
			{
				mainType='flash|';
				icon='fa-file-video-o';
			}
			//文本型代码文件
			else if((result=type.match(/\.(html|css|javascript|xml)$/)))
			{
				mainType='script|';
				icon='fa-code';
			}
			//文本型代码文件
			else if((result=name.match(/\.(asp|php|jsp|aspx)$/)))
			{
				mainType='script|';
				icon='fa-file-code-o';
			}
			//普通文本文档
			else if(type.match(/plain$/))
			{
				result=/\.(\w+?)$/i.exec(name);
				mainType='text|';
				icon='fa-file-text-o';
			}
			//word/rtf/wps
			else if((result=name.match(/\.(doc[x]|rtf|wps)?$/)))
			{
				icon='fa-file-word-o';
				mainType='office|';
			}
			//powerpoint
			else if((result=name.match(/\.(ppt[x])?$/)))
			{
				icon='fa-file-powerpoint-o';
				mainType='office|';
			}
			//excel
			else if((result=name.match(/\.(xls[x])?$/)))
			{
				icon='fa-file-excel-o';
				mainType='office|';
			}
			//压缩文档
			else if((result=name.match(/\.(zip|rar|7z|gz)$/)))
			{
				icon='fa-file-zip-o';
				mainType='package|';
			}
			//字体文件
			else if((result=name.match(/\.(ttf|otf|ttc|eot|woff)$/i)))
			{
				icon='fa-font';
				mainType='font|';
			}
			//未知文档，当没设定类型时才可以上传
			else
			{
				icon='fa-file-o';
				typeError=!TYPES;
				result=/\.(\w+?)$/i.exec(name);
			}
			
			if(!TYPES) typeError=false;
			else if(result)//如果匹配到扩展名的话才判断类型
			{
				reg=new RegExp(beginning + mainType + result[1] + ending,'i');
				typeError=TYPES.match(reg)===null;
			}
		}
		
		if(typeError)
		{
			alert("类型错误，只允许上传"+ TYPES +"类型的文件！");
			$(this).remove();
			return false;
		}
		//达到附件数上限，则删除有id的文件域，并隐藏上传标签
		if(COUNT.match(reg_count) && COUNT<=$(this).prevAll(":file").addBack().length)
		{
			$(this).next(":file").remove();
			$("label[for='"+ id +"']").hide();
		}
		
		var reader=new FileReader(),
			html='',
			str='title="'+ name +'" data-date="'+ date +'" data-size="'+ size +'"';
		//在调用前塞入容器，要先判断在当前上传域中是否已经选中过这个文件（在其它上传域中可重复）
		//reader.onloadstart//在火狐中此方法失效，不明原因
		//如果文件未被选中过则加入DOM中
		if(isImage)
			html=$('<td '+ str +'><p><s class="fa fa-spinner fa-spin"></s></p></td>');
		else
			html=$('<td '+ str +'><p><i class="fa '+ icon +'"></i></p></td>')
		html.data("file",$(this)).appendTo($("tr",album));
		album.data("scroll").refresh();
		if(isImage)//如果是图片则按DATAURL格式读取
		{
			reader.readAsDataURL(file);
			//调用后移除占位符并加入图片
			reader.onload=function(){
				var subname=/^data\:image\/(\w+)\;/.exec(this.result.substr(0,20))[1],
					img=$('<img src="'+this.result+'" alt="'+ name +'"/>').hide();
				html.find("p").empty().append(img.fadeIn())
					.closest(".CHIalbum").show()
					.next(".CHIbutton").css('display','inline-block');
			}
		}
	});
	//只显示有附件的图片集
	$(".CHIalbum").each(function(){
		if($(this).find("td").length)
		{
			$(this).show()
				.next(".CHIbutton").css('display','inline-block');
		}
	})
	//只给未来的编辑状态下的管理框绑定事件
	.on('click','.editable label',function(){
		if(GlobalLock) return;
		lockOn();
		var box=$(this).prev(":checkbox").get(0);
		box.checked=!box.checked;
		lockOff();
	})
	//给未来的a元素绑定事件，解决ISCROLL的双点击
	.on('click','a',function(){
		if(GlobalLock) return false;
		lockOn();
		lockOff();
	})
	//点击编辑图片集
	.next(".CHIbutton").click(function(){
		$(this).hide().next(".CHIbuttons").show();
		var album=$(this).prev(".CHIalbum"),
			tds=album.find("td"),
			news=tds.has("p"),
			olds=tds.has("a"),
			id=album.data("listen");
		$("label[for='"+ id +"']").hide();
		tds.each(function(){
			$(this).data('title',this.title).attr('title','点击者将被删除').addClass("editable");
			var classname=$(this).is(news) ? 'new':'old',
				url=$(this).find("a").attr('href') || '';
			//改变DOM结构，先移除原有内容包裹
			$(this).children("a,p").children().unwrap();
			//如果是已经被标记删除的，则不做变动
			if(!$(this).has("label").length)
			$(this).wrapInner("<label class='"+ classname +"'></label>")
				.children().before('<input class="CHIalbum-boxes" type="checkbox" name="'+ id +'_boxes[]" value="'+ url +'">');
		});
	})
	//编辑按钮四个：全选/反选/取消/确定
	.next(".CHIbuttons").children().focus(function(){
		this.blur();
	})
	.filter(".CHIalbum-all").click(function(){
		$(this).closest(".CHIbuttons").prevAll(".CHIalbum").eq(0)
			.find(":checkbox").prop('checked',true);
	})
	.end().filter(".CHIalbum-reverse").click(function(){
		$(this).closest(".CHIbuttons").prevAll(".CHIalbum").eq(0)
			.find(":checkbox").each(function(){
				this.checked=!this.checked;
			});
	})
	.end().filter(".CHIalbum-confirm").click(function(){
		var album=$(this).closest(".CHIbuttons").prevAll(".CHIalbum").eq(0),
			id=album.data('listen');
		album.find("td").each(function(){
			var label=$(this).find("label"),
				deleted=$(this).find(":checked").length>0;
			if(label.hasClass("new"))
			{
				if(deleted)
				{//被选的新附件将直接被删除，对应的文本域也被删除
					$(this).data("file").remove();
					$(this).remove();
				}
				else
				{//未被选的新附件还原用p标签包裹
					label.prev(":checkbox").remove();
					label.children().unwrap().wrap('<p></p>');
				}
			}
			else
			{//要被删除的附件保留删除标记，在点击提交后才会被动态脚本删除
				var box=label.prev(":checkbox"),
					url=box.val(),
					wrapper='<a href="'+ url +'" target="_blank"></a>';
				if(deleted)
				{//标记删除的要把a标签套在label之外
					label.parent().wrapInner(wrapper);
				}
				else
				{//未被删除的旧附件，直接还原成之前的样式
					box.remove();
					label.children().unwrap().wrap(wrapper);
				}
			}
			$(this).attr('title',$(this).data('title')).removeClass("editable");
		});
		//如果剩余的附件数量小于规定上限，或未规定上限，则显示上传按钮
		var label=$("label[for='"+ id +"']"),
			files=label.siblings(":file"),
			count=files.data("count");
		if(!count || files.length < count)
		{
			label.show();
			if(!$('#'+id).length)
			{//如果是从最大数量减小的话，会没有新的文件域，要添加一个才能继续使用
				label.before(files.get(0).outerHTML);
				label.prev(":file").attr('id',id);
			}
		}
		$(this).parent().hide().prev(".CHIbutton").show();
		album.data("scroll").refresh();
	});
});
$(window).load(function(){
	//图片集的滚动对象绑定到对应的上传域的label上传按钮上
	$(".CHIfile + label").each(function(){
		var album=$(".CHIalbum[data-listen='"+ $(this).attr("for") +"']"),
			scroller=new IScroll(album.get(0),GlobalAblumScrollOptions);
		$(album).data({
			scroll: scroller
		});
	});
});
</script>